version: 2

models:
  - name: mart_customer_analytics
    description: >
      Core customer analytics model for marketing teams. This model combines customer profile data
      with transaction history to create a single source of truth for customer analysis.
    config:
      materialized: table
      tags: ['marketing', 'customers']
    columns:
      - name: customer_id
        description: Primary key for customers
        tests:
          - unique
          - not_null
      - name: value_segment
        description: Customer value segmentation based on total spend and frequency
        tests:
          - accepted_values:
              values: ['High Value', 'Medium Value', 'Low Value']
      - name: engagement_segment
        description: Customer engagement status based on recency of purchases
        tests:
          - accepted_values:
              values: ['Active', 'At Risk', 'Churned']
      - name: first_order_date
        description: Date of customer's first order
        tests:
          - not_null
      - name: last_order_date
        description: Date of customer's most recent order
      - name: total_orders
        description: Total number of orders placed by customer
      - name: total_revenue
        description: Total lifetime revenue generated by customer

  - name: mart_product_analytics
    description: >
      Comprehensive product performance analytics combining sales data, inventory metrics,
      and customer behavior patterns for marketing analysis.
    config:
      materialized: table
      tags: ['marketing', 'products']
    columns:
      - name: product_id
        description: Primary key for products
        tests:
          - unique
          - not_null
      - name: revenue_category
        description: Product revenue categorization based on rolling 30-day revenue
        tests:
          - accepted_values:
              values: ['High Revenue', 'Medium Revenue', 'Low Revenue']
      - name: product_status
        description: Product sales velocity status based on recent order trends
        tests:
          - accepted_values:
              values: ['Active', 'Slowing', 'Inactive']
      - name: total_revenue_30d
        description: Total revenue in the last 30 days
      - name: units_sold_30d
        description: Total units sold in the last 30 days
      - name: average_order_value
        description: Average order value for this product

  - name: mart_daily_sales_trends
    description: >
      Daily aggregated sales metrics and trends for marketing analysis. Includes
      revenue, order counts, and key performance indicators by day.
    config:
      materialized: incremental
      tags: ['marketing', 'sales']
    columns:
      - name: sale_date
        description: Date of sales (grain of this table)
        tests:
          - unique
          - not_null
      - name: daily_revenue
        description: Total revenue for the day
      - name: order_count
        description: Number of orders for the day
      - name: average_order_value
        description: Average order value for the day
      - name: unique_customers
        description: Number of unique customers who made a purchase

  - name: mart_customer_cohorts
    description: Customer cohort analysis
    columns:
      - name: cohort_month
        description: Month when customers first purchased
        tests:
          - not_null
      - name: months_since_first_order
        description: Number of months since cohort's first order
        tests:
          - not_null
      - name: retention_rate
        description: Percentage of cohort still active
        tests:
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              max_value: 1

  - name: mart_product_bundles
    description: Product bundle analysis
    columns:
      - name: product_1_id
        description: First product in bundle
        tests:
          - not_null
      - name: product_2_id
        description: Second product in bundle
        tests:
          - not_null
      - name: bundle_strength
        description: Categorization of bundle frequency
        tests:
          - accepted_values:
              values: ['Strong Bundle', 'Medium Bundle', 'Weak Bundle']
