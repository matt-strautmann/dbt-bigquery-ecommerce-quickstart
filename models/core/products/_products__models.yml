version: 2

models:
  - name: core__product_catalog
    description: >
      Core product catalog model combining product details with sales metrics and inventory data.
      This model serves as the single source of truth for product information.
    config:
      materialized: incremental
      unique_key: product_id
      partition_by:
        field: product_created_at
        data_type: timestamp
        granularity: day
      cluster_by: ['product_type', 'performance_segment']
    
    columns:
      - name: product_id
        description: Unique identifier for the product
        tests:
          - unique
          - not_null
          - relationships:
              to: ref('stg_shopify__products')
              field: product_id

      - name: product_name
        description: Name of the product
        tests:
          - not_null

      - name: total_revenue
        description: Total revenue generated by the product
        tests:
          - not_null
          - positive_values

      - name: return_rate
        description: Percentage of units that were returned
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              max_value: 1

      - name: product_status
        description: Current status based on recent order activity
        tests:
          - not_null
          - accepted_values:
              values: ['Active', 'Slowing', 'Inactive']

      - name: performance_segment
        description: Product performance categorization
        tests:
          - not_null
          - accepted_values:
              values: ['High Performance', 'Medium Performance', 'Low Performance']

    tests:
      - dbt_expectations.expect_column_values_to_be_between:
          column_name: unit_margin
          min_value: 0
      - dbt_expectations.expect_column_values_to_be_between:
          column_name: total_margin
          min_value: 0
